<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>barcode</title>
</head>
<!-- Bootstrap 5.3.0 alpha 1 -->
<link rel="stylesheet" href="dist/bootstrap-5.3.0-alpha1-dist/css/bootstrap.css">

<body>
    <div class="container-fluid">
        <div id="reader">
            <div class="">
                <span>Информация:</span>
                <div id="text"></div>
                <span>Тип кода:</span>
                <div id="result"></div>
            </div>
        </div>
    </div>
</body>

<!-- Bootstrap 5.3.0 alpha 1 -->
<script src="dist/bootstrap-5.3.0-alpha1-dist/js/bootstrap.bundle.min.js"></script>

<!--  -->
<script src="js/html5-qrcode.min@2.3.4.js"></script>
<script>
    // 
    function onScanSuccess(decodedText, decodedResult) {
        document.getElementById('text').innerText = `${decodedText}`;
        document.getElementById('result').innerText = `${decodedResult.result.format.formatName}`;
        // document.location.href = "https://api.telegram.org/bot2100711838:AAE2qHOz6R68rHJZB93Xf_CDOyrfCiqCI7Q/sendMessage?chat_id=-1001752025790&text=result:" + `${decodedText}`;
        // console.log(`Code matched = ${decodedText}`, decodedResult);
        // window.alert(decodedText);
    }

    // let qrboxFunction = function (viewfinderWidth, viewfinderHeight) {
    //     let minEdgePercentage = 0.8; // 80%
    //     let minEdgeSize = Math.min(viewfinderWidth, viewfinderHeight);
    //     let qrboxSize = Math.floor(minEdgeSize * minEdgePercentage);
    //     return {
    //         width: qrboxSize,
    //         height: qrboxSize
    //     };
    // }

    // Square QR Box, with size = 80% of the min edge.
    let qrboxFunction = function (viewfinderWidth, viewfinderHeight) {
        let minEdgeSizeThreshold = 250;
        let edgeSizePercentage = 0.8;
        let minEdgeSize = (viewfinderWidth > viewfinderHeight) ? viewfinderHeight : viewfinderWidth;
        let qrboxEdgeSize = Math.floor(minEdgeSize * edgeSizePercentage);
        if (qrboxEdgeSize < minEdgeSizeThreshold) {
            if (minEdgeSize < minEdgeSizeThreshold) {
                return {
                    width: minEdgeSize,
                    height: minEdgeSize
                };
            } else {
                return {
                    width: minEdgeSizeThreshold,
                    height: minEdgeSizeThreshold
                };
            }
        }
        return { width: qrboxEdgeSize, height: qrboxEdgeSize };
    }

    let config = {
        // rememberLastUsedCamera: true,
        focusMode: "continuous",
        fps: 10,
        // qrbox: {
        //     width: 250,
        //     height: 250
        // },
        qrbox: qrboxFunction,
        showTorchButtonIfSupported: true,
        showZoomSliderIfSupported: true,
        defaultZoomValueIfSupported: 1,
        // supportedScanTypes: [
        //     Html5QrcodeScanType.SCAN_TYPE_CAMERA,
        //     Html5QrcodeScanType.SCAN_TYPE_FILE
        // ],
        // formatsToSupport: [
        //     Html5QrcodeSupportedFormats.QR_CODE
        // ],
    };

    let html5QrcodeScanner = new Html5QrcodeScanner(
        "reader", config, /* verbose= */ false);
    html5QrcodeScanner.render(onScanSuccess);

    //     let html5QrcodeScanner = new Html5QrcodeScanner(
    //         "reader",
    //         {
    //             fps: 10,
    //             qrbox: qrboxFunction,
    //             // Important notice: this is experimental feature, use it at your
    //             // own risk. See documentation in
    //             // mebjas@/html5-qrcode/src/experimental-features.ts
    //             experimentalFeatures: {
    //                 useBarCodeDetectorIfSupported: true
    //             },
    //             rememberLastUsedCamera: true,
    //             showTorchButtonIfSupported: true
    //         });
    //     html5QrcodeScanner.render(onScanSuccess);
    // });

</script>

</html>